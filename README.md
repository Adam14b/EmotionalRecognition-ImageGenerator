# Дизайн ML системы компьютерного зрения с возможностью генерации иллюстраций.

> ## Термины и пояснения
> - ```МКЭ``` - модель классификации эмоций по мимике (негативные, нейтральные, положительные);
> - ```МГПИ``` - модель генерации пояснительных иллюстраций;
> - ```"Dion"``` - корпоративный мессенджер для обмена сообщениями и проведения встреч в формате видеозвонка;
> - ```"Docker"``` - система контейнеров, позволяющая ращделить инфраструктуру на микросервисы. Позволяет запускать множество приложений на одном хосте, избегая конфликтов и необходимости изменять конфигурацию оборудования для каждого отдельно взятого приложения;
> - ```Хост``` - устройство, предоставляющее возможность запускать приложения удаленно в формате "клиент-сервер";
> - ```ФЗ-152``` - закон о защите персональных данных на территории Российской Федерации;
> - ```GDPR``` - общий регламент о защите данных, принятный в Европейском Союзе;
> - ```Псевдонимизация``` - процесс хранения данных, при котором каждому клиенту присваивается уникальный индентефикатор для его обезличивания и сохранения конфиденциальности;
> - ```CNN``` - сверточная нейросеть, оценивающая принадлежность к какому либо клаасу свёртками (матрица весов модели, которой она блочно проходится по картинке в поисках определенных паттернов принадлежности к классу);
> - ```GAN``` - нейросеть, состоящая из двух компонентов: генератов и дискриминатора, где генератор создает изображение, а дискриминатор оценивает эти изображения и дает команды генератору (переделать | все хорошо);
> - ```Датасет``` - набор данных;
> - ```Промт``` - короткая формулировка, которая предоставляет информацию нейросети о том, что именно требуется от нее;
> - ```FireWall``` - система сканирования трафика сети на наличие вредоносных пакетов;
> - ```Бекап``` - резервное копирование данных;
> - ```SLA``` - соглашение об уровне обслуживания (перечень услуг и сервисов, условия их предоставления и сроки, измеряемые параметры качества предоставляемой услуги: например минимально допустимая скорость передачи данных);
> - ```VPN``` - виртуальная приватная сеть (в нашем случае: позволяет пользователю, имеющиму достаточный уровень доступа, подключиться к сети компании извне);
> - ```IDS&IPS``` - система обнаружения вторжений и система предотвращения вторжений. (используются в связке друг с другом);
> - ```СУБД``` - система управления базами данных;
> - ```WSS``` - защищенный протокол потоковой передачи пакетов;
> - ```CRM``` - программа для удобного доступа к данным персональному менеджеру;
> - ```JSON``` - текстовый формат обмена данными.
### 1. Цели и предпосылки 
#### 1.1. Обоснованность разработки продукта 

##### Бизнес-цель:
- разработка системы компьютерного зрения для анализа мимики клиентов в видеоконференциях с целью выяснения какое 
  количество времени клиент был доволен разговором для дальнейшего повышения уровня обслуживания;
- генерация визуальных иллюстраций для более наглядной демонстрации доходности инвестиций клиентов [(пример иллюстрации)](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D0%B3%D0%BB%D1%8F%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png).

 ##### Описание текущего бизнес-процесса: 
За каждым клиентом закреплен личный менеджер, сопровождающий клиента, в том числе через платформу ```"Dion"```.
Менеджеру необходимо самостоятельно пояснять преимущества каких-либо банковских продуктов (не всегда эти пояснения наглядны и интуитивно понятны), а также анализировать качество диалога и удовлетворенность клиента, опираясь только на свое субъективное мнение. 

##### Почему станет лучше, чем сейчас, от использования ML:
- Для ```МКЭ```:
  - Автоматизация анализа положительной и отрицательной мимики клиентов в реальном времени позволит менеджерам точнее           считывать клиентские эмоции во время разговора, что значительно повысит качество взаимодействия и повысит уровень           клиентоориентированности. 
- Для ```МГПИ```:
  - Автоматизированная генерация визуализаций продуктов в зависимости от данных клиента позволит демонстрировать адаптивные     [иллюстрации](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D0%B3%D0%BB%D1%8F%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png), отражающие потенциальный рост их инвестиций, что повысит прозрачность предлагаемых услуг.
  
##### Что будем считать успехом итерации с точки зрения бизнеса: 
- положительный отзыв клиента о визуализации банковских продуктов;
- оптимизация временени отклика программы;
- добавление новых функций;
- исправление ошибок предыдущих итераций;
- увеличение точности предсказания ```МКЭ```;
- увеличение наглядности иллюстраций, сгенерированных ```МГПИ```;
- интенсификация инвестиций клиентом в предлагаемые инвестиционные продукты.
  
#### 1.2. Бизнес-требования и ограничения  

##### Бизнес требования:
- отслеживание положительной и отрицательной мимики клиента во время диалога с персональным менеджером для дальнейшего        составления отчета об удовлетворенности клиента;
- генерация визуальных [иллюстраций для клиента](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D0%B3%D0%BB%D1%8F%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png), для более наглядной демонстрации перспективы рассматриваемого продукта.
  
##### Бизнес ограничения:
- cистема компьютерного зрения должна работать в реальном времени во время видеоконференции;
- система должна присылать отчет-таблицу сразу после окончания видеоконференции;
- данные клиентов должны обрабатываться в соответствии с общим регламентом по защите данных ```GDPR``` и ```ФЗ-152```.

##### Что мы ожидаем от первой итерации:
- система поддерживает автономную работу каждого элемента по отдельности;
- отдельные алгоритмы системы должны показывать часть своего функционала и возможностей;
- каждый элемент системы может быть развернут и протестирован на рабочем компьютере как сотрудника, так и руководителя, проверяющего работу сотрудника;
- система готова к дальнейшему масштабированию и последующим итерациям.

##### Проведение пилота:
  
- После разработки работающего прототипа системы необходимо провести пилотное тестирование;
- Пилот должен проводиться в тех же условиях, в которых предполагается будущая работа системы;
- Пилотирование позволит оценить менеджерам и клиентам практическую пользу системы и производительность, а также понять проблемы на текущем этапе разработки и целесообразность продолжения разработки системы.

##### Критерии успеха:
- ```МКЭ```:
  	- Так как нужно избежать негативных эмоций от видеоконференции, предсказывание негативных эмоций и будет являться основной задачей модели, поэтому важно учитывать 	количество ложно положительных и ложно отрицательных предсказаний. Исходя из вышеуказанных факторов и дисбалансом классов была выбрана метрика ```F1-score```, 		умноженная на 100 для более явного представления в процентах.
  	
	- $$\text{F1-score}_{Negative} \cdot 100 \ge 80 \text{\\%, где:}$$
	> - $$\text{F1-score} = \frac{2 \cdot Presicion \cdot Recall}{Presicion + Recall}$$
	> - $$Precision = \frac{TruePositive}{TruePositive + FalsePositive}$$
	> - $$Recall = \frac{TruePositive}{TruePositive + FalseNegative}$$
	> - $$TruePositive \text{ - количество верно предсказанных значений положительного класса} $$
	> - $$FalsePositive \text{ - количество неверно предсказанных значений положительного класса}$$
  	> - $$FalseNegative \text{ - количество неверно предсказанных значений отрицательного класса}. $$
 - ```МГПИ```:
	- Визуализации должны быть ясными и понятными для клиентов. Средний балл по шкале ясности  $\ge 4.5\text{;}$
   	- Клиенты должны активно взаимодействовать с визуализациями. Уровень вовлеченности $\ge 70 \text{\\%;}$
   	- Визуализации должны быть легкими для восприятия. Среднее время, затраченное на понимание информации  $\le 2 	\text{ минуты.}$
	
#### 1.3. Что входит в первую итерации, что не входит: 
##### Что входит:
- разработка ```МКЭ```;
- разработка ```МГПИ```;
- интеграция системы на платформу ```"Dion"```;
- подготовка и проведение пилота.

##### Что не входит:
- оптимизация системы для мобильных устройств.

##### Описание планируемого технического долга (что оставляем для дальнейшей продуктивизации):
- добавить распознавание лиц каждого клиента, для последующей отчетности и отслеживания изменений степени удовлетворенности от видеоконференций;
- полная интеграция с другими корпоративными системами.

##### Описание результата с точки зрения качества кода и воспроизводимости решения:
- код будет документирован и структурирован с прописанными unit-тестами;
- воспроизводимость будет обеспечена контейнерами ```"Docker"``` (с описанием всех зависимостей и конфигураций). 

#### 1.4. Предпосылки решения  

##### Запрос бизнеса:
- цель:
	- улучшить качество обслуживания клиентов за счет использования компьютерного зрения и генерации пояснительных иллюстраций [(пример иллюстрации)](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D0%B3%D0%BB%D1%8F%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png).
 
- обоснование:
	- персональные менеджеры смогут лучше оценивать эмоциональное состояние клиента в конкретный момент времени и отслеживать тренд изменения состояния от конференции к конференции. Они смогут наглядно демонстрировать преимущества банковских продуктов в перспективе, что значительно увеличит клиентскую лояльность и удовлетворенность.

##### Блоки данных:
- видеопотоки конференций:
	- источник: видеоконференции клиентов с персональным менеджером (прямая трансляция);
 	- использование: анализ уровня удовлетворенности клиента, основываясь на его мимике.
- данные о доходности банковских продуктов:
	- источник: внутренние прогнозы банка по конкретным продуктам;
   	- использование: генерация наглядных иллюстраций, показывающих разницу в доходности разных видов инвестиций.

##### Горизонт прогноза:
- краткосрочный прогноз:
	- анализ эмоционального состояния клиентов в реальном времени в процессе видеоконференции, а также по ее завершению.

- долгосрочный прогноз:
	- визуализация изменения уровня удовлетворенности на протяжении определенного периода, а также уровень общей удовлетворенности работой персонального менеджера в этот период времени.

##### Гранулярность моделей:
- ```МКЭ```:
	- кадровая гранулярность (анализ каждого кадра видеопотока на наличие лица в кадре, с последующим анализом мимики и классификацией мимики по эмоциям).
- ```МГПИ```:
	- гибкая гранулярность (генерация пояснительных иллюстраций для разного количества банковских продуктов и уровня их доходности).

##### Обеспечение безопасности данных:
- технические меры:
	- шифрование данных;
        -  контроль доступа к данным;
        -  ```псевдонимизация``` данных.
- юридические меры:
	- соблюдение ```ФЗ-152``` и ```GDPR```;
 	- регулярные аудиты о безопасности.

### 2. Методология     

#### 2.1. Постановка задачи  
##### Основная задача:
- Разработка системы компьютерного зрения для анализа эмоций клиентов и генерации наглядных визуализаций финансовых продуктов во время видеоконференций.

##### Детализация:
- ```МКЭ```:
	- цель: Разработать и внедрить модель классификации на базе ```CNN```, способную создать [отчет-таблицу](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BE%D1%82%D1%87%D0%B5%D1%82-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0.png), показывающую уровень общей удовлетворенности и отдельных эмоций в процентах;
	- описание: Модель должна классифицировать мимику по эмоциям, агрегировать их, а затем расчитывать пропорции различных эмоций и заполнять [отчет-таблицу](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BE%D1%82%D1%87%D0%B5%D1%82-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0.png). Особое внимание следует уделить точности предсказания негативных эмоций для оперативного реагирования персональным менеджером;
	- $\text{метрика успеха: F1-score для негативных эмоций} \ge 80 \text{\\%}$.
- ```МГПИ```:
	- цель: Разработать систему генерации наглядных иллюстраций доходности банковских продуктов клиенту;
	- описание: Дообучить предобученные генеративные модели (визуализации должны быть интерактивными и объясняющими разницу в доходности на простых вещах (например, [деревья различной высоты](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%20%D0%BD%D0%B0%D0%B3%D0%BB%D1%8F%D0%B4%D0%BD%D0%BE%D0%B9%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8.png), показывающие разницу в доходности банковских продуктов). Предобученные модели необходимо запускать локально([пример дообучения модели](https://colab.research.google.com/github/huggingface/notebooks/blob/main/diffusers/training_example.ipynb#scrollTo=584739c5-83f5-4077-8379-89a7c9ff1bf2).

- Интеграция с системой видеоконференций:
	- цель: Система должна быть интегрирована на платформу ```"Dion"``` для обеспечения их бесперебойной работы в реальном времени сразу после запуска видеоконференции;
	- описание: Необходимо интегрировать все модели так, чтобы все запускалось по одному клику со стороны менеджера с интуитивно понятным интерфейсом, без дополнительной настройки со стороны менеджера и клиента;
	- метрика успеха: процесс запуска видеоконференции не должен усложниться, менеджеру не требуется дополнительных технических навыков для освоения в системе. Качество связи и время отклика не должны измениться. 

- Улучшение и оптимизация модели:
  	- цель: добиться минимального времени отклика, максимальной точности ```МКЭ```, позитивной обратной связи от менеджеров и клиентов по поводу ```МГПИ```;
  	- описание: Необходимо оптимизировать скорость генерации иллюстраций и распознавания эмоций, так же необходимо добиться максимально высокого показателя F1-score для ```МКЭ```. Показатель положительных отзывов о ```МГПИ``` $\ge$ 80%;
  	- метрика успеха: F1-score, положительные отзывы от менеджеров и клиентов. 

#### 2.2. Блок-схема решения  
[блок схема решения задчи](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/52a7a8e676e4660d85cb5121f826b41850604406/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%B1%D0%BB%D0%BE%D0%BA-%D1%81%D1%85%D0%B5%D0%BC%D0%B0%20%D1%80%D0%B5%D1%88%D0%B5%D0%BD%D0%B8%D1%8F.jpg)
#### 2.3. Этапы решения задачи `Data Scientist` :
#### 2.3.1. Этап 0:

##### ```МКЭ```: 
- Сбор данных:
	- для обучения необходим ```датасет```, содержащий маркированные фотографии с различной мимикой.
- Сокращение категорий эмоций до 3-х категорий (на примере ```датасета``` ["FER2013"](https://www.kaggle.com/datasets/msambare/fer2013), где можно сократить число категорий с 7-и до 3-х): [Negative](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/f395119e4223d34c569c18299fd801bd060c5872/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/Negative_data.jpg) ; [Neutral](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/f395119e4223d34c569c18299fd801bd060c5872/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/Neutral_data.jpg) ; [Positive](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/f395119e4223d34c569c18299fd801bd060c5872/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/Positive_data.jpg);
- поиск аномальных фотографий (на которых не изображены лица людей);
- проверка на дисбаланс в данных после сокращения числа категорий;
- Разбиение данных на обучающую и тестовую выборки в соотношении 80/20.
> на выходе необходимо получить очищенные данные, разбитые на 3 категории, а также разделенные на обучающую и тестовую выборки.
  
| Название данных  | Есть ли данные в компании | Требуемый ресурс для получения данных | Проверено ли качество данных |
| ------------- | ------------- | ------------- | ------------- |
| Маркированные фотографии лиц | -  | ["Kaggle"](https://www.kaggle.com) ; ["GitHub"](github.com) ; подобные открытые ресурсы | зависит от выбранного ```датасета``` |

##### ```МГПИ```(MVP):
| Название данных  | Есть ли данные в компании | Требуемый ресурс для получения данных | Проверено ли качество данных |
| ------------- | ------------- | ------------- | ------------- |
| Фотографии деревьев | -  | ["Kaggle"](https://www.kaggle.com) ; ["GitHub"](github.com) ; подобные открытые ресурсы | зависит от выбранного ```датасета``` |

- Сбор данных:
	- для обучения необходим ```датасет```, содержащий различные фотографии деревьев.
- Необходимая предобработка данных:
	- поиск аномальных фотографий (на которых изображено что-то кроме деревьев);
	- Разбиение данных на обучающую и тестовую выборки в соотношении 80/20.
> на выходе необходимо получить очищенные данные, разделенные на обучающую и тестовую выборки.

##### ```МГПИ```(Baseline):
Требуется найти предобученную модель, способную быстро и качественно генерировать изображения. Запуск модели должен происходить локально из соображений безопасности.

#### 2.3.2. Этап 1:
##### ```МКЭ```: 
Необходимо построить и обучить ```CNN``` модель классификации эмоций, а также добавить агрегацию эмоций с дальнейшим подсчетом и выводом результатов в таблицу.

##### ```МГПИ```(MVP):
Необходимо найти подходящую для дообучения модель и дообучить ее на подходящих данных, полученных в результате  <strong>2.3.1. Этап 0</strong>. Запуск и дообучение модели должны происходить локально из соображений безопасности.

##### ```МГПИ```(Baseline):
Необходимо подобрать и протестировать на разных входных данных универсальный промт, результат генерации по которому будет ожидаемым и подходящим под требования к ```МГПИ```.

#### 2.3.3. Этап 2:
Важно проинтерпретировать и сравнить результаты всех моделей, а также сравнить ```МГПИ```(Baseline) и ```МГПИ```(MVP). В случае успеха(результаты удовлетворяют бизнес требованиям), следует отправить их заказчику на рассмотрение, в ином случае следует вернуться к <strong>2.3.1. Этап 0</strong>. 

#### 2.3.4. Этап 3:
##### ```МКЭ```: 
Необходимо добавить агрегацию эмоций с дальнейшим подсчетом и выводом результатов в таблицу, а также интегрировать систему на платформу ```"Dion"```.

##### ```МГПИ```:
Необходимо добавить пользовательский интерфейс и сделать интеграцию с платформой ```"Dion"```.

#### 2.3.5. Этап 4:

Оптимизировать обучение и работу моделей и клиентской части.

#### 2.3.6. Этап 5:

Необходимо подготовить отчет с промежуточными результатами и демонстрацией модели заказчику. В случае одобрения результатов заказчиком, необходимо начинаить подготовку пилота. 

#### 2.3.7 Этап 6:
Добавление модуля распознавания лиц для ```МКЭ``` и исправление минорных ошибок в работе моделей.



  
#### 2.3.8. Этап 7:
Необходимо провести пилот, по результатом которого станет ясно, стоит ли развивать систему в дальнейшем. Подробнее в главе <strong>3. Подготовка пилота</strong>.


### 3. Подготовка пилота  

#### 3.1. Способ оценки пилота  
Тестирование модели может проводиться на небольшой выборке реальных клиентов (10-20 человек), которые были уведомлены о предстоящем тестировании модели (опционально, при согласовании с юридическим отделом), а так же дали свое согласие на обработку персональных данных. В этом случае необходимо организовать видеоконференции с выбранными для тестирования клиентами, во время которых менеджер будет использовать программу для отслеживания мимики и последующей классификацией эмоций, с дальнейшей агрегацией и вычислением степени удовлетворенности видеоконференцией.
Для тестирования ```МГПИ``` дополнительного согласия на обработку персональных данных не требуется, достаточно уведомить клиента о проведении тестирования.
Подразумевается, что клиенты будут давать обратную связь по завершении видеоконференции. Сравнив вывод ```МКЭ``` [(отчет-таблица)](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BE%D1%82%D1%87%D0%B5%D1%82-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0.png) и отзыв клиента, можно сделать вывод о достоверности информации, полученной из модели.
Анализ качества ```МГПИ``` основывается исключительно на отзыве клиента и менеджера компании.

##### Другие варианты тестирования:
в случае невозможности проведения тестирования на реальных клиентах, предлагаются два альтернативных варианта проведения тестирования:
- проводить тестирование на работниках компании: после уведомления работников компании о проведении тестирования, систему необходимо интегрировать во внутреннюю программу видеоконференций. Затем необходимо получить обратную связь от работников компании (уровень удовлетворенности от проведенной видеоконференции). Сравнив [вывод](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BE%D1%82%D1%87%D0%B5%D1%82-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0.png) ```МКЭ``` и отзывы работников о видеоконференции, можно сделать вывод о качестве данных, которые выводит модель, с поправкой на человеческий фактор;
- проводить "синтетические" тесты, используя заранее маркированный видеоматериал. Выводы модели будут сравниваться с маркировкой видеоматериала.

Вне зависимости от метода проведения пилота, основным способом оценки ```МКЭ``` является $F1-score$, второстепенно (для проведения тестирования на клиентах/сотрудниках) можно сравнивать обратную связь о конференции с выводами модели. 
Объективной оценки качества ```МГПИ``` не существует, оценка качества иллюстрации может происходить только клиентом и/или сотрудником, так как не существует объективных метрик измерения качества моделей генерации изображений. 


#### 3.2. Что считаем успешным пилотом  
  
Пилотный проект считается успешным, если система отработала без критических ошибок и достигла ожидаемых результатов, менеджеры и клиенты остались довольны её работой, предоставили обратную связь и замечания для улучшения, а также система облегчила работу менеджеров и вызвала положительную реакцию у клиентов. Обратная связь поможет улучшить и оптимизировать сисему(возможно с внедрением новых необходимых функций).
  
#### 3.3. Подготовка пилота  

Для успешного проведения пилота необходимо учитывать затраты на вычислительные ресурсы и оценить их объем. Важно запустить тестовые сценарии для оценки среднего потребления вычислительных мощностей сервера. Затем необходимо оптимизировать систему под доступные вычислительные мощности и подготовить программу для постоянного мониторинга потребления ресурсов системой во время пилота. Итоговым резултатом должна стать оптимизированная система, которая будет справляться с многопоточным тестированием в реальных условия.

### 4. Внедрение системы в рабочий процесс:  
  
#### 4.1. Архитектура решения   
  
[блок-схема принципы работы системы](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/c03ac9422f82851b28c4deb44e7c121b9f9d9ade/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%B1%D0%BB%D0%BE%D0%BA-%D1%81%D1%85%D0%B5%D0%BC%D0%B0%20%D1%80%D0%B0%D0%B1%D0%BE%D1%82%D1%8B%20%D1%81%D0%B8%D1%81%D1%82%D0%B5%D0%BC%D1%8B.jpg)

##### Этап 1:
- система, состоящая из ```МКЭ``` и ```МГПИ``` запускается одновременно с началом видеоконференции;
- на экране у менеджера отображается текущее состояние клиента и поле ввода ```промта``` для генерации пояснительной иллюстрации.

##### Этап 2:
- ```МКЭ```('видеопоток(клиент)'):
	- модель получает видеопоток клиента в виде отдельных картинок (кадров).
- ```МГПИ```('получение данных о вкладах'):
	- модель получает ```промт```, содержащий название вкладов и их доходность.

##### Этап 3:
- ```МКЭ```('обработка кадра'):
	- модель преобразует кадр в черно-белый формат с оттенками серого, для упрощения вычислений и уменьшения объема данных 		(обучающие данные были такого же черно-белого формата).
- ```МГПИ```('генерация визуализации'):
	- модель генерирует пояснительную иллюстрацию и демонстрирует ее менеджеру, который принимает решение - показывать текущую иллюстрацию клиенту или сгенерировать новую, изменив ```промт``` или указав модели на ошибки в сгенерированной иллюстрации.

##### Этап 4:
- ```МКЭ```('детекция лица'):
	- модель ищет лицо в кадре при помощи метода Хаара, преимущество которого заключается в быстроте обнаружения лиц, что критически важно при потоковом видео.
- ```МГПИ```('вывод визуализации'):
	- в случае нажатия менеджером на кнопки 'поделиться с клиентом', клиенту демонстрируется пояснительная иллюстрация.
##### Этап 5:
- ```МКЭ```('предсказание эмоций'):
	- модель предсказывает, какая именно из 3 эмоций(Negative, Neutral, Positive) сейчас демонстрируется клиентом.
- ```МГПИ```('ождание дальнейших указаний'):
	- модель возвращается в состояние <strong>Этап 2('получение данных о вкладах')</strong> и готова к новому ```промту```.

##### Этап 6:
- ```МКЭ```('Агрегация эмоций'):
	- модель инкрементирует одну из переменных, отвечающих за количество конкретной эмоции.
	> инкрементирует - добавляет +1(в нашем случае, если выполняется условие наличия конкретной эмоции в кадре)
- ```МГПИ```('ождание дальнейших указаний'):
	- модель возвращается в состояние <strong>Этап 2('получение данных о вкладах')</strong> и готова к новому ```промту```.

##### Этап 7:
- ```МКЭ```('следующий кадр'):
	- в случае продолжения видеоконференции после первой итерации модели, она возвращается в состояние <strong>Этап 2('видеопоток (клиент)')</strong>.
- ```МГПИ```('ождание дальнейших указаний' | 'Генерация визуализации'):
	- в зависимости от результатов предыдущего этапа, модель может генерировать новое изображение или продолжать ожидание промта.

##### Этап 8: 
- ```МКЭ```('Конец видеоконференции'):
	- по завершению видеоконференции модель начинает создавать [(отчет-таблицу)](https://github.com/Adam14b/EmotionalRecognition-ImageGenerator/blob/9f3f1534748363855a782029c96189b38de701d5/%D0%BF%D1%80%D0%B8%D0%BC%D0%B5%D1%80%D1%8B%20%D0%B8%20%D0%B8%D0%BB%D0%BB%D1%8E%D1%81%D1%82%D1%80%D0%B0%D1%86%D0%B8%D0%B8/%D0%BE%D1%82%D1%87%D0%B5%D1%82-%D1%82%D0%B0%D0%B1%D0%BB%D0%B8%D1%86%D0%B0.png), подсчитывая соотношения всех эмоций друг к другу(в процентах) по формулам:
> - 'Общая удовлетворенность': $\frac{0.5 \cdot NeutralAmount + PositiveAmount}{0.5 \cdot NeutralAmount + PositiveAmount + NegativeAmount} \cdot 100\\%$ ($NeutralAmount$ имеет коэффициент ```0.5```, так как нейтральные эмоции в меньшей степени влияют на удовлетворенность клиента конференцией)
> - 'негативные эмоции': $\frac{NegativeAmount}{NeutralAmount + PositiveAmount + NegativeAmount} \cdot 100\\%$
> - 'нейтральные эмоции': $\frac{NeutralAmount}{NeutralAmount + Positive_Amount + NegativeAmount} \cdot 100\\%$
> - 'позитивные эмоции': $\frac{PositiveAmount}{NeutralAmount + PositiveAmount + NegativeAmount} \cdot 100\\%$
>	> где $NegativeAmount, NeutralAmount, PositiveAmount$ - количество эмоций определенного класса, насчитанное моделью за время конференции.
- ```МГПИ```('Конец видеоконференции'):
	- по завершению видеоконференции модель прекращает свою работу.

##### Этап 9:
- ```МКЭ```('формирование итоговой оценки'):
	- модель выводит таблицу, заполненную данными из <strong>Этапа 8</strong>.
- ```МГПИ```:
	- модель находится в выключенном состоянии.


	
#### 4.2. Описание инфраструктуры и масштабируемости 
##### Выбранная инфраструктура: Собственные серверы 

##### Плюсы и минусы собственных серверов:
- Плюсы:
	- полный контроль над процессом (возможность гибко настраивать серверы и их программное обеспечение под спецефические требования);
  	- полная конфиденциальность: из-за полного контроля над серверами, возможность контролировать весь процесс передачи данных между серверами и устройствами;
	- экономия: возможность разместить несколько проектов на одном сервере, в долгосрочной перспективе затраты на сервер станут намного ниже, чем на облачные хранилища.

- Минусы:
	- высокие первоначальные затраты на покупку и настройку сервера;
	- масштабирование инфраструктуры требует закупки и настройки дорогостоющего оборудования;
	- необходима команда системных администраторов для обслуживания и управления серверами.
 
##### Почему финальный выбор лучше альтернативных вариантов:
- собственная инфраструктура позволяет максимизировать уровень безопасности данных и минимизировать риски доступа извне, что является одним из главных преимуществ для размещения нашей системы;
- в отличие от облачных ресурсов, система никак не зависит от провайдера, а также (в перспективе) выбор собственного сервера окупит себя экономически;
- размещение на личных устройствах сотрудников не рассматривается, в связи с высоким риском нарушить конфиденциальность клиента;
- централизованность позволяет легко вносить обновления и дополнительные функции в проект.

#### 4.3. Требования к работе системы  
##### ```SLA```:
- система доступна не менее 90% времени (с учетом технических работ и установки обновлений);
- система должна в реальном времени обрабатывать данные для ```МКЭ```  и ```МГПИ```;
- поддержка для решения критических инцидентов должна работать круглосуточно.
  
##### Пропускная способность:
- система, в стандартном ее состоянии, должна без перегрузки и сбоев одновременно обрабатывать до 50 видеоконференций в разрешении '1920 x 1080' при 30 кадрах в секунду для каждой сессии;
- при приближении к критической отметке одновременно проводимых видеоконференций система должна начать автоматическое масштабирование для изменения максимального количества одновременно проводимых видеоконференций, без изменения производительности текущих видеоконференций.
  
##### Допустимые задержки в работе системы:
- ```МКЭ```:
	- задержка на обработку и распознавание эмоции для каждого кадра не должно превышать 100мс.
- ```МГПИ```:
	- задержка на обработку ```промта```, генерацию и отображение иллюстрации менеджеру не должно превышать 10с.
  
#### 4.4. Безопасность системы  
##### Потенциальные уязвимости и способы их решения:
- Неавторизованный доступ:
	- Способы предотвращения угрозы:
	> - назначение ролей с различными уровнями доступа к системе;
	> - закрытый исходный код системы;
	> - сканирование пакетов системы через ```FireWall```;
	> - система обнаружения вторжений (```IDS&IPS```);
	> - доступ к системе только авторизаванным пользователям;     
	> - данные хранятся в зашифрованном виде;     
	> - доступ к системе только через внутренние каналы компании (локальный доступ/```VPN```); 
	> - сквозное шифрование при любой передаче данных.
	

- Утечка/удаление базы данных:
	- Способы предотвращения угрозы:
	> - назначение ролей с различными уровнями доступа к системе;
	> - доступ к системе только авторизованным пользователям;
	> - доступ к системе только через внутренние каналы компании (локальный доступ/```VPN```);         
	> - ```псевдонимизация``` данных о клиентах;
	>  - данные хранятся в зашифрованном виде;
	> - сканирование пакетов системы через ```FireWall```;
	> - ```бекап``` системы раз в полгода на физических носителях без доступа к сети.

- DDOS/DOS атаки:
	- Способы предотвращения угрозы:
	> - доступ к системе только через внутренние каналы компании (локальный доступ/```VPN```);
	> - система обнаружения вторжений (```IDS&IPS```).

#### 4.5. Безопасность данных   
  
##### Соблюдение ФЗ-152 и GDPR:
- сбор и обработка данных происходит только после явного согласия клиента;
- клиент имеет право на доступ к данным и их удаление;
- данные о клиентах подвергаются псевдонимизации;
- собираются и хранятся только необходимые данные, без избыточности.

##### Технические меры:
- используется сквозное шифрование при любой передаче данных;
- данные хранятся только в зашифрованном виде;
- для доступа в систему используется, минимум, двухфакторная аутентификация;
- назначение ролей с различными уровнями доступа к системе хранения данных;
- при любых операциях с данными логи записываются в зашифрованный журнал, защищенный от несанкционированного доступа и изменений;
- обработка видеоданных происходит в реальном времени, сами видеоданные на сервере храниться не могут.

##### Организационные меры:
- с каждым сотрудником, перед выдачи ему доступа к системе, проводится аудит по кибербезопасности;
- разработана подробная политика безопасности.

  
#### 4.6. Издержки  
##### Предположительные расходы:
- покупка и установка оборудования для ```хостинга``` системы;
- аренда/покупка помещения для размещения серверов;
- покупка системы охлаждения серверного помещения;
- электроэнергия для питания серверов, сетевого оборудования и поддержания необходимой температуры в серверном помещении;
- поддержка серверов (сетевое обслуживание, оплата труда команды системных администраторов);
- круглосуточная техподдержка (оплата труда операторов технической поддержки);
- покупка и продление лицензий программного обеспечения ( ```СУБД```, операционная система, инструменты для виртуализации и другие программные продукты);
- регулярные ```бэкапы``` (покупка и хранение физических носителей для хранения ```бэкапов```);
- регулярные обновления и улучшения системы (оплата труда команды разработчиков системы);
- непредвиденные затраты ( поломки оборудования, найм новых сотрудников для обслуживания, затраты на случай предотвращения/исправления последствий взлома и/или утечки данных).
  
Требует консультации с отделом закупок и бухгалтерией (для уточнения закупочных цен и расходов на сотрудников).
#### 4.7. Integration points  
  
- взаимодействие платформы ```"Dion"``` и сервера с системой будет происходить посредством ```WSS```, так как необходим высокий уровень безобасности и потоковая передача видео;
- сохранение данных происходит посредством подготовленных SQL-запросов в коде системы;
- система взаимодействует с ```CRM``` при помощи обмена ```json``` файлами;
- данные в аналитическую систему передаются по протоколу ```WSS``` в реальном времени.
  
  


